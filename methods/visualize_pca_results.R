require(cluster)
require(RColorBrewer)

#' Set working directory
if (dir.exists("/mnt/data/asis/untwist/")) {
  setwd("/mnt/data/asis/untwist/")
}

#' Load transposed accession coordinates generated by our principal component
#' analysis:
unt_eigenvecs <- read.table(
  "results/all_public_and_all_untwist_SNP_filtered_pca.eigenvec",
  header = TRUE,
  quote = "",
  sep = "\t",
  stringsAsFactors = FALSE
)
#' Extract a table with _only_ the eigenvectors and rownames being the
#' accession identifiers:
unt_coords <- unt_eigenvecs[, colnames(unt_eigenvecs)[grepl("^PC\\d+$", colnames(unt_eigenvecs))]]
rownames(unt_coords) <- unt_eigenvecs$IID

unt_cex <- unlist(lapply(rownames(unt_coords), function(accession_id) {
  if (grepl("^UNT", accession_id)) {
    0.75
  } else {
    0.5
  }
}))
col_pal <- brewer.pal(3, "Set1")
unt_col <- unlist(lapply(rownames(unt_coords), function(accession_id) {
  if (grepl("^UNT", accession_id)) {
    col_pal[[1]]
  } else {
    col_pal[[2]]
  }
}))
unt_labels <- sub(
  "_(reseq|new)$", "",
  sub("^CAMPUB", "C", sub("^UNT", "U", rownames(unt_coords)))
)
pdf(paste0("./results/principal_component_scatterplot.pdf"))
plot(
  x = unt_coords[, 1], y = unt_coords[, 2], type = "n",
  main = "Principal Component Analysis",
  xlab = "1st principal component",
  ylab = "2nd principal component"
)
text(
  x = unt_coords[, 1], y = unt_coords[, 2], labels = unt_labels,
  col = unt_col, cex = unt_cex
)
legend("topleft",
  fill = col_pal[1:2],
  legend = c("(U)ntwist", "Publi(C)"), title = "Type of Camelina accessions",
  cex=0.6125, bty = "n"
)
dev.off()
